<%- include('includes/header') %>

<link rel="stylesheet" href="/css/products.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

<div class="products-container">

  <div class="navigation-menu">
    <ul class="nav">
      <li class="nav-item"><a href="/admin/">Home</a></li>
      <li class="nav-item"><a href="/admin/product/all">Menu</a></li>
      <li class="nav-item"><a href="/admin/user/all">Users</a></li>
      <li class="nav-item" style="cursor: pointer;" onclick="return confirm('Do you want to logout?')">
        <a href="/admin/logout">Logout</a>
      </li>
    </ul>
  </div>

  <div class="admin-menu-frame">
    <div class="board">
      <div class="animals-table">
        <span class="new-animal-txt" style="margin-bottom: 30px">PET SHOP MENU</span>

        <table class="table table-bordered table-hover">
          <thead class="thead-light">
            <tr>
              <th>T/r</th>
              <th>Image</th>
              <th>Product Name</th>
              <th>Product Type</th>
              <th>Product Size / Year</th>
              <th>Product Price</th>
              <th>Product Left Count</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <% products.forEach(function(value, key) { %>
            <tbody style="background: white">
              <tr>
                <td><%= key + 1 %></td>
                <td>
                  <% if (value.productImages && value.productImages.length > 0) { %>
                    <img src="/<%= value.productImages[0] %>" alt="Product Image" class="table-img" />
                  <% } else { %>
                    <img src="/img/default.png" alt="Default Image" class="table-img" />
                  <% } %>
                </td>

                <td><%= value.productName %></td>
                <td><%= value.productCollection %></td>
                <td><%= value.productCollection === 'FISH' ? value.productSize : value.productYear %></td>
                <td>$<%= value.productPrice %></td>
                <td><%= value.productLeftCount %></td>
                <td>
                  <select class="new-product-status" id="<%= value._id %>">
                    <option value="PAUSE" <%= value.productStatus === 'PAUSE' ? 'selected' : '' %>>PAUSE</option>
                    <option value="PROCESS" <%= value.productStatus === 'PROCESS' ? 'selected' : '' %>>PROCESS</option>
                    <option value="DELETE" <%= value.productStatus === 'DELETE' ? 'selected' : '' %>>DELETE</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-warning edit-btn" data-id="<%= value._id %>">
                    <i class="fas fa-pen"></i>
                  </button>
                  <form action="/admin/product/delete/<%= value._id %>" method="POST" 
                        onsubmit="return confirm('Are you sure to delete this product?')" 
                        style="display:inline-block;">
                    <button type="submit" class="btn btn-danger delete-btn">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </td>
              </tr>
            </tbody>
          <% }) %>
        </table>

        <div class="long-input" style="align-items: flex-end; margin-top: 25px;">
          <button class="btn btn-primary" id="process-btn">New Product</button>
        </div>
      </div>

      <!-- CREATE NEW PRODUCT FORM -->
      <form
        action="/admin/product/create"
        method="POST"
        enctype="multipart/form-data"
        class="animal-container"
        style="display:none"
        onsubmit="return validateForm()"
        id="newProductForm"
      >
        <div class="long-input" style="display: flex; align-items: center;">
          <span class="new-animal-txt">NEW PETS DETAIL</span>
        </div>

        <div class="long-input">
          <label>Product Name</label>
          <input type="text" name="productName" class="product-name" required />
        </div>

        <input type="hidden" name="productStatus" value="PAUSE" />

        <div class="half-input-frame">
          <div class="half-input">
            <label>Product Price</label>
            <input type="number" name="productPrice" class="product-price" required />
          </div>
          <div class="half-input">
            <label>Product Left Count</label>
            <input type="number" name="productLeftCount" class="product-left-count" required />
          </div>
        </div>

        <div class="half-input-frame">
          <div class="half-input">
            <label>Product Type</label>
            <select name="productCollection" class="product-collection" required>
              <option value="FISH">Fish</option>
              <option value="DOG">Dog</option>
              <option value="CAT">Cat</option>
              <option value="PARROT">Parrot</option>
              <option value="HAMSTER">Hamster</option>
              <option value="TURTLE">Turtle</option>
              <option value="OTHER">Other</option>
            </select>
          </div>

          <div class="half-input" id="product-collection">
            <label>Fish Size</label>
            <select name="productSize" class="product-size" required>
              <option value="SMALL">Small</option>
              <option value="NORMAL" selected>Normal</option>
              <option value="LARGE">Large</option>
            </select>
          </div>

          <div class="half-input" id="product-volume" style="display:none;">
            <label>Animals Year</label>
            <select name="productVolume" class="product-volume">
              <option value="ONE_WEEK">ONE WEEK</option>
              <option value="TWO_WEEK">TWO WEEK</option>
              <option value="THREE_WEEK">THREE WEEK</option>
              <option value="ONE_MONTH" selected>ONE MONTH</option>
              <option value="TWO_MONTH">TWO MONTH</option>
              <option value="THREE_MONTH">THREE MONTH</option>
              <option value="FOUR_MONTH">FOUR MONTH</option>
              <option value="FIVE_MONTH">FIVE MONTH</option>
              <option value="SIX_MONTH">SIX MONTH</option>
              <option value="SEVEN_MONTH">SEVEN MONTH</option>
              <option value="EIGHT_MONTH">EIGHT MONTH</option>
              <option value="NINE_MONTH">NINE MONTH</option>
              <option value="ONE_YEAR">ONE YEAR</option>
              <option value="TWO_YEAR">TWO YEAR</option>
              <option value="THREE_YEAR">THREE YEAR</option>
              <option value="ANY">ANY</option>
            </select>
          </div>
        </div>

        <div class="long-input">
          <label>Product Description</label>
          <textarea name="productDesc" class="product-desc" rows="5"></textarea>
        </div>

        <div class="img-frame">
          <label>Product Images</label>
          <div class="media-frame">
            <% for(let i = 1; i <= 5; i++) { %>
              <div class="upload-img-box">
                <img src="/img/upload.svg" class="image-preview" />
                <input 
                type="file" 
                name="productImages" 
                class="image-file" 
                onchange="previewFileHandler(this)" 
                accept="image/*" />
              </div>


            <% } %>
          </div>
        </div>

        <div class="operation-buttons">
          <button class="btn btn-danger" id="cancel-btn" type="button">Cancel</button>
          <button type="submit" class="btn btn-primary" id="create-btn">Create</button>
        </div>
      </form>
  
      <!-- UPDATE PRODUCT FORM -->

      <form
        action=""
        method="POST"
        enctype="multipart/form-data"
        class=" update-container"
        style="display:none"
        onsubmit="return validateUpdateForm()"
        id="updateForm"
        id="updateProductForm"
      >
        <div class="long-input" style="display: flex; align-items: center;">
          <span class="new-animal-txt">UPDATE PRODUCT DETAIL</span>
        </div>

        <input type="hidden" name="id" id="update-id" />

        <div class="long-input">
          <label>Product Name</label>
          <input type="text" name="productName" id="update-productName" class="product-name" required />
        </div>

        <input type="hidden" name="productStatus" value="PAUSE" />

        <div class="half-input-frame">
          <div class="half-input">
            <label>Product Price</label>
            <input type="number" name="productPrice" id="update-productPrice" class="product-price" required />
          </div>
          <div class="half-input">
            <label>Product Left Count</label>
            <input type="number" name="productLeftCount" id="update-productLeftCount" class="product-left-count" required />
          </div>
        </div>

        <div class="half-input-frame">
          <div class="half-input">
            <label>Product Type</label>
            <select name="productCollection" id="update-productCollection" class="product-collection" required>
              <option value="FISH">Fish</option>
              <option value="DOG">Dog</option>
              <option value="CAT">Cat</option>
              <option value="PARROT">Parrot</option>
              <option value="HAMSTER">Hamster</option>
              <option value="TURTLE">Turtle</option>
              <option value="OTHER">Other</option>
            </select>
          </div>

          <div class="half-input" id="update-product-collection">
            <label>Fish Size</label>
            <select name="productSize" id="update-productSize" class="product-size" required>
              <option value="SMALL">Small</option>
              <option value="NORMAL" selected>Normal</option>
              <option value="LARGE">Large</option>
            </select>
          </div>

          <div class="half-input" id="update-product-volume" style="display:none;">
            <label>Animals Year</label>
            <select name="productVolume" id="update-productVolume" class="product-volume">
              <option value="ONE_WEEK">ONE WEEK</option>
              <option value="TWO_WEEK">TWO WEEK</option>
              <option value="THREE_WEEK">THREE WEEK</option>
              <option value="ONE_MONTH" selected>ONE MONTH</option>
              <option value="TWO_MONTH">TWO MONTH</option>
              <option value="THREE_MONTH">THREE MONTH</option>
              <option value="FOUR_MONTH">FOUR MONTH</option>
              <option value="FIVE_MONTH">FIVE MONTH</option>
              <option value="SIX_MONTH">SIX MONTH</option>
              <option value="SEVEN_MONTH">SEVEN MONTH</option>
              <option value="EIGHT_MONTH">EIGHT MONTH</option>
              <option value="NINE_MONTH">NINE MONTH</option>
              <option value="ONE_YEAR">ONE YEAR</option>
              <option value="TWO_YEAR">TWO YEAR</option>
              <option value="THREE_YEAR">THREE YEAR</option>
              <option value="ANY">ANY</option>
            </select>
          </div>
        </div>

        <div class="long-input">
          <label>Product Description</label>
          <textarea name="productDesc" id="update-productDesc" class="product-desc" rows="5" required></textarea>
        </div>

        <div class="img-frame">
          <label>Product Images</label>
          <div class="media-frame">
            <% for(let i = 1; i <= 5; i++) { %>
              <div class="upload-img-box">
                <img src="/img/upload.svg" class="image-preview" />
                <input 
                  type="file" 
                  name="productImages" 
                  class="image-file" 
                  onchange="previewFileHandler(this)" 
                  accept="image/*" 
                />
              </div>
            <% } %>
          </div>
        </div>

        <div class="operation-buttons">
          <button class="btn btn-danger" id="update-cancel-btn" type="button">Cancel</button>
          <button type="submit" class="btn btn-primary" id="update-btn">Update</button>
        </div>
            </form>

          </div>
        </div>
      </div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/products.js"></script>

<%- include('includes/footer') %>

